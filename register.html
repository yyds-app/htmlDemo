<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>注册</title>
<style>
body { font-family: Arial; margin:0; padding:20px; background:#f5f5f5; }
.container { background:#fff; padding:20px; margin:50px auto; border-radius:10px; max-width:400px; box-shadow:0 4px 8px rgba(0,0,0,0.1);}
input { width:100%; padding:12px; margin:10px 0; border-radius:6px; border:1px solid #ccc; }
button { width:100%; padding:12px; margin-top:10px; background:#4CAF50; color:#fff; font-size:16px; border:none; border-radius:6px; }
button:hover { background:#45a049; }
#message { text-align:center; margin-top:15px; font-weight:bold; }
a { display:block; text-align:center; margin-top:10px; color:#333; text-decoration:none; }
a:hover { text-decoration:underline; }
</style>
</head>
<body>

<div class="container">
<h2>注册</h2>
<input type="text" id="regAccount" placeholder="账号">
<input type="password" id="regPassword" placeholder="密码">
<input type="text" id="regUserName" placeholder="用户名">
<button onclick="register()">注册</button>
<a href="login.html">去登录</a>
<div id="message"></div>
</div>

<script>
const SUPABASE_URL = 'https://difmdyqvnncqfehiioce.supabase.co/rest/v1/';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRpZm1keXF2bm5jcWZlaGlpb2NlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMjY3NjAsImV4cCI6MjA3NzkwMjc2MH0.bZuGDW2iNZWAuZ-GesIgByjDVxP3ezzZXTBRVNK99-Y';
const HEADERS = { "apikey": SUPABASE_KEY, "Authorization": "Bearer "+SUPABASE_KEY, "Content-Type":"application/json", "Prefer":"return=representation" };

function showMessage(msg,color='red'){ document.getElementById('message').style.color=color; document.getElementById('message').innerText=msg; }

async function register(){
    const account = document.getElementById('regAccount').value.trim();
    const password = document.getElementById('regPassword').value.trim();
    const userName = document.getElementById('regUserName').value.trim();
    if(!account||!password||!userName){ showMessage('请填写完整注册信息'); return; }

    // 判重
    let res = await fetch(`${SUPABASE_URL}users?userAccount=eq.${account}`, { headers:HEADERS });
    let existing = await res.json();
    if(existing.length>0){ showMessage('账号已存在'); return; }

    let response = await fetch(`${SUPABASE_URL}users`, { method:'POST', headers:HEADERS, body:JSON.stringify({userAccount:account,pwd:password,userName:userName}) });
    let data = await response.json();
    if(response.ok){ showMessage('注册成功','green'); console.log(data); }
    else { showMessage('注册失败'); console.error(data); }
}
</script>

</body>
</html>
